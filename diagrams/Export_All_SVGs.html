<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPRM Diagrams - SVG Export</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eaeaea;
            padding: 2rem;
        }
        h1 { text-align: center; margin-bottom: 1rem; color: #e94560; }
        .instructions {
            background: #16213e;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .instructions h2 { color: #4285F4; margin-bottom: 1rem; }
        .instructions ol { margin-left: 1.5rem; }
        .instructions li { margin-bottom: 0.5rem; }
        .btn-export-all {
            display: block;
            width: 300px;
            margin: 2rem auto;
            padding: 1rem 2rem;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-export-all:hover { background: #ff6b6b; }
        .btn-export-all:disabled { background: #666; cursor: not-allowed; }
        .status {
            text-align: center;
            margin: 1rem 0;
            font-size: 1.1rem;
        }
        .diagram-container {
            display: none;
        }
        .progress {
            max-width: 600px;
            margin: 1rem auto;
            background: #16213e;
            border-radius: 8px;
            padding: 1rem;
        }
        .progress-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid #0f3460;
        }
        .progress-item:last-child { border-bottom: none; }
        .progress-item.done { color: #34A853; }
        .progress-item.processing { color: #FBBC04; }
    </style>
</head>
<body>
    <h1>TPRM Process Flow Diagrams - SVG Export</h1>

    <div class="instructions">
        <h2>Export Instructions</h2>
        <ol>
            <li>Click the <strong>"Export All SVGs"</strong> button below</li>
            <li>Wait for all diagrams to render and download</li>
            <li>Check your Downloads folder for 9 SVG files</li>
            <li>Import SVGs into Lucidchart: <strong>File > Import > Select SVG files</strong></li>
        </ol>
    </div>

    <button class="btn-export-all" onclick="exportAllSVGs()">Export All SVGs</button>

    <div class="status" id="status">Ready to export</div>

    <div class="progress" id="progress" style="display: none;"></div>

    <!-- Hidden diagram containers -->
    <div class="diagram-container" id="diagrams">
        <div id="d1" class="mermaid">
flowchart LR
    subgraph LIFECYCLE["TPRM LIFECYCLE"]
        A[("1. IDENTIFY")] --> B[("2. ASSESS")]
        B --> C[("3. ENGAGE")]
        C --> D[("4. MONITOR")]
        D --> E[("5. EXIT")]
        E -.-> A
    end
    style A fill:#4285F4,stroke:#1a73e8,color:#fff
    style B fill:#FBBC04,stroke:#f9a825,color:#000
    style C fill:#34A853,stroke:#1e8e3e,color:#fff
    style D fill:#A142F4,stroke:#8430ce,color:#fff
    style E fill:#EA4335,stroke:#c5221f,color:#fff
        </div>

        <div id="d2" class="mermaid">
flowchart TD
    START((Start)) --> A[Business Unit submits vendor request]
    A --> B[TPRM Team reviews request]
    B --> C[Request vendor questionnaire]
    C --> D[Vendor submits questionnaire]
    D --> E[Determine inherent risk tier]
    E --> F{Risk Tier?}
    F -->|High| G[Enhanced due diligence]
    F -->|Medium| H[Standard due diligence]
    F -->|Low| I[Limited due diligence]
    G --> J{Approved?}
    H --> J
    I --> J
    J -->|No| K[Return to BU]
    K --> END1((Rejected))
    J -->|Yes| L[Contract negotiation]
    L --> M[System access provisioning]
    M --> N[Add to monitoring]
    N --> END2((Active))
    style START fill:#34A853,color:#fff
    style END1 fill:#EA4335,color:#fff
    style END2 fill:#34A853,color:#fff
    style F fill:#FBBC04,color:#000
    style J fill:#FBBC04,color:#000
        </div>

        <div id="d3" class="mermaid">
flowchart TD
    subgraph INHERENT["INHERENT RISK"]
        A1[Data Sensitivity] --> CALC
        A2[Access Level] --> CALC
        A3[Criticality] --> CALC
        A4[Financial Exposure] --> CALC
        CALC[Risk Score 4-20]
    end
    CALC --> TIER{Risk Tier}
    TIER -->|15-20| HIGH[HIGH RISK]
    TIER -->|10-14| MED[MEDIUM RISK]
    TIER -->|4-9| LOW[LOW RISK]
    HIGH --> CA[Control Assessment]
    MED --> CA
    LOW --> CA
    CA --> RES[RESIDUAL RISK]
    RES --> RATING((Final Rating))
    style TIER fill:#FBBC04,color:#000
    style HIGH fill:#EA4335,color:#fff
    style MED fill:#FBBC04,color:#000
    style LOW fill:#34A853,color:#fff
    style RATING fill:#A142F4,color:#fff
        </div>

        <div id="d4" class="mermaid">
flowchart TD
    A1[Prepare DD package] --> A2[Request documents]
    A2 --> V1[Vendor provides evidence]
    V1 --> A5[Review SOC reports]
    A5 --> S1[Security review]
    S1 --> S2[Legal review]
    S2 --> S3[Privacy review]
    S3 --> A6[Compile findings]
    A6 --> M1[Manager approval]
    M1 --> DONE((Complete))
    style A1 fill:#4285F4,color:#fff
    style V1 fill:#A142F4,color:#fff
    style S1 fill:#FBBC04,color:#000
    style M1 fill:#34A853,color:#fff
    style DONE fill:#34A853,color:#fff
        </div>

        <div id="d5" class="mermaid">
flowchart TD
    START[Risk Assessment Complete] --> A[TPRM provides requirements]
    A --> B[Legal reviews contract]
    B --> C{Vendor accepts?}
    C -->|No| D[Negotiate]
    D --> C
    C -->|Yes| E[Execute contract]
    E --> F[Record in systems]
    F --> G[Set reminders]
    G --> DONE((Complete))
    style START fill:#4285F4,color:#fff
    style C fill:#FBBC04,color:#000
    style DONE fill:#34A853,color:#fff
        </div>

        <div id="d6" class="mermaid">
flowchart TD
    subgraph MONITOR["CONTINUOUS MONITORING"]
        M1[Security Ratings] --> DASH
        M2[News Alerts] --> DASH
        M3[Financial Health] --> DASH
        DASH[Alert Dashboard]
    end
    DASH --> A{Alert?}
    A -->|No| LOG[Document]
    A -->|Yes| B[Investigate]
    B --> C{Material?}
    C -->|No| LOG
    C -->|Yes| D[Escalate]
    D --> E[Reassess]
    E --> LOG
    style A fill:#FBBC04,color:#000
    style C fill:#FBBC04,color:#000
    style D fill:#EA4335,color:#fff
    style DASH fill:#4285F4,color:#fff
        </div>

        <div id="d7" class="mermaid">
flowchart TD
    START((Incident)) --> A[Log incident]
    A --> B[Triage severity]
    B --> SEV{Severity?}
    SEV --> P1[P1 Critical]
    SEV --> P2[P2 High]
    SEV --> P3[P3 Medium]
    SEV --> P4[P4 Low]
    P1 --> NOTIFY[Notify stakeholders]
    P2 --> NOTIFY
    P3 --> NOTIFY
    P4 --> NOTIFY
    NOTIFY --> C[Coordinate with vendor]
    C --> D{Our data affected?}
    D -->|Yes| F[Internal IR]
    F --> G[Monitor remediation]
    D -->|No| G
    G --> H[Post-incident review]
    H --> I{Continue vendor?}
    I -->|No| K[Offboard]
    I -->|Yes| L[Update monitoring]
    style START fill:#EA4335,color:#fff
    style P1 fill:#EA4335,color:#fff
    style P2 fill:#FF6D01,color:#fff
    style P3 fill:#FBBC04,color:#000
    style P4 fill:#34A853,color:#fff
        </div>

        <div id="d8" class="mermaid">
flowchart TD
    START((Offboarding)) --> A[Notify vendor]
    A --> D1[Request data return]
    A --> A1[Revoke access]
    A --> K1[Document processes]
    D1 --> D2[Verify deletion]
    A1 --> A2[Disable VPN]
    K1 --> K2[Archive records]
    D2 --> CHECK[Checklist complete]
    A2 --> CHECK
    K2 --> CHECK
    CHECK --> B[Final sign-off]
    B --> DONE((Complete))
    style START fill:#EA4335,color:#fff
    style DONE fill:#34A853,color:#fff
    style D1 fill:#4285F4,color:#fff
    style A1 fill:#A142F4,color:#fff
    style K1 fill:#FBBC04,color:#000
        </div>

        <div id="d9" class="mermaid">
flowchart TD
    subgraph INPUT["RISK FACTORS"]
        F1[Data Sensitivity 1-5]
        F2[Access Level 1-5]
        F3[Criticality 1-5]
        F4[Financial 1-5]
    end
    F1 --> SCORE[TOTAL 4-20]
    F2 --> SCORE
    F3 --> SCORE
    F4 --> SCORE
    SCORE --> T1[CRITICAL 18-20]
    SCORE --> T2[HIGH 15-17]
    SCORE --> T3[MEDIUM 10-14]
    SCORE --> T4[LOW 4-9]
    style T1 fill:#EA4335,color:#fff
    style T2 fill:#FF6D01,color:#fff
    style T3 fill:#FBBC04,color:#000
    style T4 fill:#34A853,color:#fff
    style SCORE fill:#4285F4,color:#fff
        </div>
    </div>

    <script>
        const diagramNames = [
            '01_TPRM_Lifecycle',
            '02_Vendor_Onboarding',
            '03_Risk_Assessment',
            '04_Due_Diligence',
            '05_Contract_Management',
            '06_Ongoing_Monitoring',
            '07_Incident_Response',
            '08_Vendor_Offboarding',
            '09_Risk_Tier_Matrix'
        ];

        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: { useMaxWidth: false, htmlLabels: true, curve: 'basis' },
            securityLevel: 'loose'
        });

        async function exportAllSVGs() {
            const btn = document.querySelector('.btn-export-all');
            const status = document.getElementById('status');
            const progress = document.getElementById('progress');

            btn.disabled = true;
            status.textContent = 'Rendering diagrams...';
            progress.style.display = 'block';
            progress.innerHTML = diagramNames.map(name =>
                `<div class="progress-item" id="prog-${name}">${name}.svg <span>Pending</span></div>`
            ).join('');

            // Wait for mermaid to render
            await new Promise(resolve => setTimeout(resolve, 2000));

            for (let i = 0; i < diagramNames.length; i++) {
                const name = diagramNames[i];
                const progItem = document.getElementById(`prog-${name}`);
                progItem.classList.add('processing');
                progItem.querySelector('span').textContent = 'Processing...';

                const svg = document.getElementById(`d${i + 1}`).querySelector('svg');
                if (svg) {
                    // Clone and clean up SVG
                    const svgClone = svg.cloneNode(true);
                    svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');

                    const svgData = new XMLSerializer().serializeToString(svgClone);
                    const blob = new Blob([svgData], { type: 'image/svg+xml' });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${name}.svg`;
                    a.click();
                    URL.revokeObjectURL(url);

                    progItem.classList.remove('processing');
                    progItem.classList.add('done');
                    progItem.querySelector('span').textContent = 'Downloaded!';
                } else {
                    progItem.querySelector('span').textContent = 'Error';
                }

                // Small delay between downloads
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            status.textContent = 'All SVGs exported! Check your Downloads folder.';
            btn.disabled = false;
            btn.textContent = 'Export Again';
        }
    </script>
</body>
</html>
